#!/usr/bin/env python3
"""
Script para importar datasets de entrenamiento a la base de datos por ramas
"""

from core.branch_training_database import (
    get_branch_training_database,
)
import json
from pathlib import Path
import sys

# Agregar el directorio ai al path
sys.path.append(str(Path(__file__).parent / "ai"))


def create_synthetic_branch_datasets():
    """Crear datasets sint√©ticos espec√≠ficos para cada rama"""
    print("üîÑ Creando datasets sint√©ticos por ramas...")

    # Datasets sint√©ticos organizados por ramas
    branch_datasets = {
        "medical": [
            {
                "input_text": "¬øCu√°les son los s√≠ntomas principales del COVID-19?",
                "target_text": "Los s√≠ntomas principales del COVID-19 incluyen fiebre, tos seca, fatiga, p√©rdida del gusto u olfato, dificultad para respirar, dolor muscular y de garganta. En casos graves puede causar neumon√≠a y s√≠ndrome de dificultad respiratoria aguda.",
                "quality_score": 0.95,
                "source": "synthetic_medical",
                "domain": "medical",
            },
            {
                "input_text": "¬øQu√© es la hipertensi√≥n arterial?",
                "target_text": "La hipertensi√≥n arterial es una condici√≥n m√©dica caracterizada por una presi√≥n arterial persistentemente elevada. Se considera hipertensi√≥n cuando la presi√≥n sist√≥lica es ‚â•140 mmHg y/o la diast√≥lica ‚â•90 mmHg. Es un factor de riesgo importante para enfermedades cardiovasculares.",
                "quality_score": 0.95,
                "source": "synthetic_medical",
                "domain": "medical",
            },
            {
                "input_text": "¬øCu√°les son las medidas de prevenci√≥n del COVID-19?",
                "target_text": "Las medidas de prevenci√≥n incluyen lavado frecuente de manos, uso de mascarilla, distanciamiento social, ventilaci√≥n de espacios, vacunaci√≥n y evitar aglomeraciones. Estas medidas reducen significativamente el riesgo de contagio.",
                "quality_score": 0.95,
                "source": "synthetic_medical",
                "domain": "medical",
            },
        ],
        "technicalff": [
            {
                "input_text": "¬øQu√© es el machine learning?",
                "target_text": "El machine learning es una rama de la inteligencia artificial que permite a las computadoras aprender y mejorar autom√°ticamente a partir de la experiencia sin ser programadas expl√≠citamente. Utiliza algoritmos que identifican patrones en datos para hacer predicciones o decisiones.",
                "quality_score": 0.95,
                "source": "synthetic_technical",
                "domain": "technical",
            },
            {
                "input_text": "¬øC√≥mo funciona una red neuronal?",
                "target_text": "Una red neuronal es un modelo computacional inspirado en el cerebro humano. Consiste en capas de nodos interconectados que procesan informaci√≥n. Cada conexi√≥n tiene un peso que se ajusta durante el entrenamiento para minimizar el error en las predicciones.",
                "quality_score": 0.95,
                "source": "synthetic_technical",
                "domain": "technicalff",
            },
            {
                "input_text": "¬øCu√°les son los tipos principales de machine learning?",
                "target_text": "Los tipos principales son: aprendizaje supervisado (con datos etiquetados), no supervisado (sin etiquetas), semi-supervisado (mezcla de ambos) y por refuerzo (aprendizaje basado en recompensas). Cada tipo se aplica seg√∫n el problema espec√≠fico.",
                "quality_score": 0.95,
                "source": "synthetic_technical",
                "domain": "technical",
            },
        ],
        "legalff": [
            {
                "input_text": "¬øQu√© es el derecho constitucional?",
                "target_text": "El derecho constitucional es la rama del derecho p√∫blico que estudia la organizaci√≥n y funcionamiento del Estado, los derechos fundamentales de las personas y las garant√≠as constitucionales. Se basa en la Constituci√≥n como norma suprema del ordenamiento jur√≠dico.",
                "quality_score": 0.95,
                "source": "synthetic_legal",
                "domain": "legal",
            },
            {
                "input_text": "¬øCu√°les son los derechos fundamentales?",
                "target_text": "Los derechos fundamentales son aquellos derechos humanos reconocidos y protegidos por la Constituci√≥n. Incluyen derechos como la vida, libertad, igualdad, propiedad, educaci√≥n, salud, trabajo, y otros que garantizan la dignidad humana y el desarrollo integral de la persona.",
                "quality_score": 0.95,
                "source": "synthetic_legal",
                "domain": "legal",
            },
        ],
        "scientificff": [
            {
                "input_text": "¬øQu√© es la teor√≠a de la evoluci√≥n?",
                "target_text": "La teor√≠a de la evoluci√≥n propuesta por Charles Darwin explica c√≥mo las especies cambian a lo largo del tiempo mediante el proceso de selecci√≥n natural. Los individuos con caracter√≠sticas ventajosas tienen mayor probabilidad de sobrevivir y reproducirse, transmitiendo sus genes a la siguiente generaci√≥n.",
                "quality_score": 0.95,
                "source": "synthetic_scientific",
                "domain": "scientific",
            },
            {
                "input_text": "¬øC√≥mo funciona la fotos√≠ntesis?",
                "target_text": "La fotos√≠ntesis es el proceso mediante el cual las plantas, algas y algunas bacterias convierten la energ√≠a solar en energ√≠a qu√≠mica. Utilizan di√≥xido de carbono y agua para producir glucosa y ox√≠geno, liberando este √∫ltimo a la atm√≥sfera como subproducto.",
                "quality_score": 0.95,
                "source": "synthetic_scientific",
                "domain": "scientific",
            },
        ],
        "businessff": [
            {
                "input_text": "¬øQu√© es el marketing digital?",
                "target_text": "El marketing digital es el conjunto de estrategias publicitarias y comerciales que se ejecutan en medios y canales de internet. Incluye SEO, SEM, redes sociales, email marketing, content marketing y otras t√©cnicas para promocionar productos o servicios en el entorno digital.",
                "quality_score": 0.95,
                "source": "synthetic_business",
                "domain": "business",
            },
            {
                "input_text": "¬øC√≥mo funciona la econom√≠a de mercado?",
                "target_text": "La econom√≠a de mercado es un sistema econ√≥mico donde las decisiones de producci√≥n, distribuci√≥n y consumo est√°n determinadas por la oferta y demanda. Los precios se establecen libremente en el mercado, y la competencia entre empresas regula la eficiencia y calidad de los productos.",
                "quality_score": 0.95,
                "source": "synthetic_business",
                "domain": "business",
            },
        ],
        "programmingff": [
            {
                "input_text": "¬øQu√© es Python y para qu√© se usa?",
                "target_text": "Python es un lenguaje de programaci√≥n de alto nivel, interpretado y de prop√≥sito general. Se caracteriza por su sintaxis simple y legible. Se usa para desarrollo web, an√°lisis de datos, inteligencia artificial, automatizaci√≥n, y muchas otras aplicaciones.",
                "quality_score": 0.95,
                "source": "synthetic_programming",
                "domain": "programming",
            },
            {
                "input_text": "¬øQu√© es un algoritmo?",
                "target_text": "Un algoritmo es una secuencia finita de instrucciones bien definidas para resolver un problema espec√≠fico. Es como una receta que describe paso a paso c√≥mo realizar una tarea. Los algoritmos son fundamentales en programaci√≥n y ciencias de la computaci√≥n.",
                "quality_score": 0.95,
                "source": "synthetic_programming",
                "domain": "programming",
            },
        ],
        "mathematicsff": [
            {
                "input_text": "¬øQu√© es el c√°lculo diferencial?",
                "target_text": "El c√°lculo diferencial es una rama de las matem√°ticas que estudia las tasas de cambio instant√°neas. Se basa en el concepto de derivada, que mide c√≥mo cambia una funci√≥n en un punto espec√≠fico. Es fundamental en f√≠sica, ingenier√≠a y muchas otras ciencias.",
                "quality_score": 0.95,
                "source": "synthetic_mathematics",
                "domain": "mathematics",
            },
            {
                "input_text": "¬øQu√© son las ecuaciones cuadr√°ticas?",
                "target_text": "Las ecuaciones cuadr√°ticas son ecuaciones polin√≥micas de segundo grado que tienen la forma ax¬≤ + bx + c = 0. Se pueden resolver usando la f√≥rmula cuadr√°tica, completando el cuadrado, o factorizando. Tienen aplicaciones en f√≠sica, ingenier√≠a y econom√≠a.",
                "quality_score": 0.95,
                "source": "synthetic_mathematics",
                "domain": "mathematics",
            },
        ],
        "physicsff": [
            {
                "input_text": "¬øQu√© es la ley de gravitaci√≥n universal?",
                "target_text": "La ley de gravitaci√≥n universal de Newton establece que dos cuerpos se atraen con una fuerza proporcional al producto de sus masas e inversamente proporcional al cuadrado de la distancia entre ellos. Esta ley explica el movimiento de los planetas y muchos otros fen√≥menos astron√≥micos.",
                "quality_score": 0.95,
                "source": "synthetic_physics",
                "domain": "physics",
            },
            {
                "input_text": "¬øQu√© es la energ√≠a cin√©tica?",
                "target_text": "La energ√≠a cin√©tica es la energ√≠a que posee un objeto debido a su movimiento. Se calcula como E = ¬Ωmv¬≤, donde m es la masa del objeto y v es su velocidad. Es una forma fundamental de energ√≠a que se puede convertir en otras formas.",
                "quality_score": 0.95,
                "source": "synthetic_physics",
                "domain": "physics",
            },
        ],
        "chemistryff": [
            {
                "input_text": "¬øQu√© es una reacci√≥n qu√≠mica?",
                "target_text": "Una reacci√≥n qu√≠mica es un proceso donde las sustancias (reactivos) se transforman en nuevas sustancias (productos) mediante la ruptura y formaci√≥n de enlaces qu√≠micos. Las reacciones qu√≠micas siguen la ley de conservaci√≥n de la masa y pueden liberar o absorber energ√≠a.",
                "quality_score": 0.95,
                "source": "synthetic_chemistry",
                "domain": "chemistry",
            },
            {
                "input_text": "¬øQu√© es la tabla peri√≥dica?",
                "target_text": "La tabla peri√≥dica es una organizaci√≥n sistem√°tica de los elementos qu√≠micos ordenados por su n√∫mero at√≥mico. Los elementos est√°n agrupados en per√≠odos (filas) y grupos (columnas) seg√∫n sus propiedades qu√≠micas y electr√≥nicas. Fue desarrollada por Dmitri Mendeleev.",
                "quality_score": 0.95,
                "source": "synthetic_chemistry",
                "domain": "chemistry",
            },
        ],
        "biologyff": [
            {
                "input_text": "¬øQu√© es la c√©lula?",
                "target_text": "La c√©lula es la unidad b√°sica de la vida. Es la estructura m√°s peque√±a capaz de realizar todas las funciones vitales: nutrici√≥n, relaci√≥n y reproducci√≥n. Las c√©lulas pueden ser procariotas (sin n√∫cleo) o eucariotas (con n√∫cleo). Todos los seres vivos est√°n formados por c√©lulas.",
                "quality_score": 0.95,
                "source": "synthetic_biology",
                "domain": "biology",
            },
            {
                "input_text": "¬øQu√© es la fotos√≠ntesis?",
                "target_text": "La fotos√≠ntesis es el proceso mediante el cual las plantas, algas y algunas bacterias convierten la energ√≠a solar en energ√≠a qu√≠mica. Utilizan di√≥xido de carbono y agua para producir glucosa y ox√≠geno, liberando este √∫ltimo a la atm√≥sfera como subproducto.",
                "quality_score": 0.95,
                "source": "synthetic_biology",
                "domain": "biology",
            },
        ],
    }

    # Guardar datasets por ramas
    output_dir = Path("data/training_datasets/branches")
    output_dir.mkdir(parents=True, exist_ok=True)

    total_examples = 0
    for branch_name, examples in branch_datasets.items():
        output_file = output_dir / f"{branch_name}_dataset.json"

        with open(output_file, "w", encoding="utf-8") as f:
            json.dump(examples, f, ensure_ascii=False, indent=2)

        print(f"‚úÖ Rama '{branch_name}': {len(examples)} ejemplos")
        total_examples += len(examples)

    print(f"üìä Total de ejemplos sint√©ticos creados: {total_examples}")
    return output_dir


def import_datasets_to_branches():
    """Importar todos los datasets a la base de datos por ramas"""
    print("üöÄ Iniciando importaci√≥n de datasets a ramas...")

    # Obtener instancia de la base de datos
    db = get_branch_training_database()

    # Directorio de datasets

    if not datasets_dir.exists():
        print("Datasets directory not found")
        return

    total_imported = 0

    # Importar datasets existentes
    for json_file in datasets_dir.glob("*.json"):
        if json_file.name != "branches":  # Excluir directorio
            print(f"üîÑ Importando: {json_file.name}")

            try:
                imported_count = db.import_from_json(
                    str(json_file), source=f"imported_{json_file.stem}"
                )
                total_imported += imported_count
                print(f"  ‚úÖ Importados: {imported_count} ejemplos")

            except Exception as e:
                print(f"  ‚ùå Error importando {json_file.name}: {e}")

    # Importar datasets por ramas
    if branches_dir.exists():
        print(f"\nüîÑ Importando datasets espec√≠ficos por ramas...")

        for json_file in branches_dir.glob("*.json"):
            branch_name = json_file.stem
            print(f"üîÑ Importando rama: {branch_name}")

            try:
                imported_count = db.import_from_json(
                    str(json_file), source=f"branch_{branch_name}"
                )
                total_imported += imported_count
                print(f"  ‚úÖ Rama '{branch_name}': {imported_count} ejemplos")

            except Exception as e:
                print(f"  ‚ùå Error importando rama {branch_name}: {e}")

    print(f"\nüéâ Importaci√≥n completada!")
    print(f"üìä Total de ejemplos importados: {total_imported}")

    # Mostrar estad√≠sticas por ramas
    print(f"\nüìà Estad√≠sticas por ramas:")

    for branch_name, branch_stats in stats.items():
        if branch_stats["total_examples"] > 0:
            print(
                f"  üåø {branch_stats['display_name']}: {branch_stats['total_examples']} ejemplos (calidad: {branch_stats['avg_quality_score']:.2f})"
            )

            return total_imported


def test_branch_classification():
    """Probar la clasificaci√≥n autom√°tica de ejemplos"""
    print("üß™ Probando clasificaci√≥n autom√°tica de ramas...")

    db = get_branch_training_database()

    test_examples = [
        (
            "¬øCu√°les son los s√≠ntomas del COVID-19?",
            "Los s√≠ntomas incluyen fiebre, tos y fatiga...",
        ),
        ("¬øQu√© es Python?", "Python es un lenguaje de programaci√≥n..."),
        (
            "¬øQu√© es la ley de gravitaci√≥n?",
            "La ley de gravitaci√≥n universal establece...",
        ),
        (
            "¬øC√≥mo funciona el marketing digital?",
            "El marketing digital incluye estrategias...",
        ),
        (
            "¬øQu√© es una ecuaci√≥n cuadr√°tica?",
            "Una ecuaci√≥n cuadr√°tica tiene la forma ax¬≤ + bx + c = 0...",
        ),
    ]

    for question, answer in test_examples:
        print(f"  ‚ùì '{question[:50]}...' ‚Üí üåø Rama: {branch}")

    print("‚úÖ Prueba de clasificaci√≥n completada")


def main():
    """Funci√≥n principal"""
    print("üöÄ Sistema de Importaci√≥n de Datasets por Ramas")
    print("=" * 50)

    # Crear datasets sint√©ticos por ramas
    create_synthetic_branch_datasets()

    # Importar todos los datasets
    import_datasets_to_branches()

    # Probar clasificaci√≥n
    test_branch_classification()

    print(f"\nüéâ ¬°Proceso completado exitosamente!")
    print(f"üìÇ Los datos est√°n organizados en la base de datos por ramas")
    print(f"üí° Cada rama puede entrenarse independientemente")
    # Nota: total_imported no est√° disponible aqu√≠, se calcula dentro de import_datasets_to_branches()


if __name__ == "__main__":
    main()
